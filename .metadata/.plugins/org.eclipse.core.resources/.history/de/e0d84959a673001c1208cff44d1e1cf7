package basePage;


import java.io.FileInputStream;
	import java.io.FileNotFoundException;
	import java.io.IOException;
	import java.lang.reflect.Method;
	import java.util.Properties;
	import java.util.logging.Logger;

	import org.apache.log4j.PropertyConfigurator;
	import org.testng.ITestResult;
	import org.testng.annotations.AfterMethod;
	import org.testng.annotations.AfterTest;
	import org.testng.annotations.BeforeMethod;
	import org.testng.annotations.BeforeSuite;

	import com.aventstack.extentreports.Status;

import webUtills.WebUtills;
	
	public class TestBase {

		protected WebUtills wb = new WebUtil();
		public static final Logger logger = Logger.getLogger(TestBase.class.getName());

		@BeforeSuite
		public void beforeSuite() throws Exception {
			logger.info("Test Suite Execution is started sucessfully");

			Properties prop = new Properties();
			FileInputStream fis = null;
			try {
				fis = new FileInputStream("src/main/resources/Log4J.properties");
			} catch (FileNotFoundException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			}
			try {
				prop.load(fis);
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			PropertyConfigurator.configure(prop);

			wb.load_config("src//test//resources//config.properties");

			wb.initHtmlReport();
			logger.info("BeforSuite Has been executed");
			VideoRecorder_utlity.startRecord(wb.getSimpleDateTimeFormate());

		}

		@BeforeMethod(alwaysRun = true)
		public void beforeMethod(Method testMethod) throws Exception {

			String testMethodNme = testMethod.getName();
			wb.setExtentLogger(testMethodNme);
			wb.setTestCaseDataMap(new ExcelUtil().getTestCaseData(testMethodNme));
			logger.info("BeforeMethod Has been started");
			wb.launchBrowser("chrome");
			wb.navigateUrl("https://facebook.com");

			logger.info("BeforeMethod Has been ended");

		}

		@AfterMethod(alwaysRun = true)
		public void afterMethod(ITestResult result) throws Exception {

			if (result.getStatus() == ITestResult.FAILURE) {
				wb.getExtentLogger().log(Status.FAIL, "TEST CASE FAILED IS " + result.getName()); // to add name in extent
																									// report
				wb.getExtentLogger().log(Status.FAIL, "TEST CASE FAILED IS " + result.getThrowable()); // to add
																										// error/exception
																										// in extent

				String screenshotPath = wb.takeSnapshot(result.getName()); // to add screen shot in extent reports
				wb.getExtentLogger().addScreenCaptureFromPath(screenshotPath);

			} else if (result.getStatus() == ITestResult.SKIP) {
				wb.getExtentLogger().log(Status.SKIP, "Test Case SKIPPED IS " + result.getName());
			} else if (result.getStatus() == ITestResult.SUCCESS) {
				wb.getExtentLogger().log(Status.PASS, "Test Case PASSED IS " + result.getName());
			}
			
			//wb.closeDriver();
		}

		@AfterTest
		public void afterSuite() throws Exception {
			logger.info("Test Suite Execution method has been Start");
			wb.flushExtentsReport();
			VideoRecorder_utlity.stopRecord();
			new sendJavaMail(wb.getAttachMentLocation());
			logger.info("Test Suite Execution method has been completed");

		}

	}
}
