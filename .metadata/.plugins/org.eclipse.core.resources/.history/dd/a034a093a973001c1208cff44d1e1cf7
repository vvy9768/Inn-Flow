package BasePage;

import java.io.IOException;
import org.testng.ITestResult;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.AfterSuite;
import org.testng.annotations.AfterTest;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.BeforeSuite;
import org.testng.annotations.BeforeTest;
import org.testng.log4testng.Logger;
import com.aventstack.extentreports.ExtentReports;
import com.aventstack.extentreports.ExtentTest;
import com.aventstack.extentreports.Status;

import Listeners.SendJavaMailReport;
import webUtills.WebUtills;

public class TestBasePage {
	
protected WebUtills utill;
protected static final Logger logger = Logger.getLogger(TestBasePage.class.getClass());  
 public ExtentTest test;

 ExtentReports extent;
@BeforeTest
public void beforeSuit() {
	
	logger.info("Test Suite Execution is started sucessfully");
	utill.initHtmlReport();
	logger.info("BeforSuite Has been executed");

	
}
 
 
 
	@BeforeMethod (alwaysRun = true)
	public void beforeMethod() {
		utill=WebUtills.getObj();
		utill.loadConfig("src/main/resources/PropFiles/Config.properties");
	  	utill.launchBrowser(utill.getPropVal("browser"));
		test.log(Status.INFO ,"Starting Test case");
		utill.maximize();
		utill.get(utill.getPropVal("url"));
		utill.imlicitlyWait(15);
		
 }


	@AfterMethod(alwaysRun = true)
	public void afterMethod(ITestResult result) {
		
		if (result.getStatus() == ITestResult.FAILURE) {
			utill.getExtentLogger().log(Status.FAIL, "TEST CASE FAILED IS " + result.getName()); // to add name in extent
																								// report
			utill.getExtentLogger().log(Status.FAIL, "TEST CASE FAILED IS " + result.getThrowable()); // to add
																									// error/exception
																									// in extent

			String screenshotPath = utill.takeSnapshot(utill.getdriver(),result.getName()); // to add screen shot in extent reports
			try {
				utill.getExtentLogger().addScreenCaptureFromPath(screenshotPath);
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}

		} else if (result.getStatus() == ITestResult.SKIP) {
			utill.getExtentLogger().log(Status.SKIP, "Test Case SKIPPED IS " + result.getName());
		} else if (result.getStatus() == ITestResult.SUCCESS) {
			utill.getExtentLogger().log(Status.PASS, "Test Case PASSED IS " + result.getName());
		}
	
	}
@AfterTest
public void afterSuit() {
	logger.info("Test Suite Execution method has been Start");
    extent.flush();
    new SendJavaMailReport(utill.getPathOfReport());
	utill.quitBrowser();
	logger.info("Test Suite Execution method has been completed");

}
}
